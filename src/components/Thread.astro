---
import Cast from './Cast.astro';

interface ThreadProps {
	thread: Array<{
		hash: string;
		text: string;
		author?: {
			username: string;
			fid?: number;
			displayName?: string;
			pfpUrl?: string;
		};
		timestamp?: string;
		reactions?: number;
		replies?: number;
		embeds?: Array<{
			type: 'image' | 'frame' | 'url';
			url: string;
		}>;
	}>;
	maxCasts?: number;
	showAll?: boolean;
	compact?: boolean;
}

const { thread = [], maxCasts = 3, showAll = false, compact = false } = Astro.props;

const displayCasts = showAll ? thread : thread.slice(0, maxCasts);
const remainingCasts = showAll ? 0 : Math.max(0, thread.length - maxCasts);
const rootHash = thread[0]?.hash || '';
---

<div class="thread-container thread-container-{compact ? 'compact' : ''}">
	{displayCasts.map((cast, index) => (
		<div class={`cast-item cast-item-${index === 0 ? 'first' : 'reply'}`}>
			<Cast
				hash={cast.hash}
				text={cast.text}
				author={cast.author}
				timestamp={cast.timestamp}
				reactions={cast.reactions}
				replies={cast.replies}
				embeds={cast.embeds}
			/>
		</div>
	))}

	{!showAll && remainingCasts > 0 && (
		<div class="thread-expand">
			<a href={`https://farcaster.xyz/suchbot/${rootHash}`} target="_blank" class="see-thread-link">
				See full thread â†’
			</a>
		</div>
	)}
</div>

<style>
	.thread-container {
		border-left: 2px solid var(--border);
		padding-left: 0;
		margin-left: 1rem;
	}

	.thread-container-compact .cast-item {
		padding: 0.5rem 0.75rem;
	}

	.thread-container-compact .cast-header {
		gap: 0.5rem;
		margin-bottom: 0.5rem;
	}

	.thread-container-compact .cast-text {
		margin: 0 0.5rem;
		font-size: 0.9rem;
	}

	.thread-container-compact .cast-footer {
		padding-top: 0.5rem;
	}

	.thread-container-compact .cast-timestamp,
	.thread-container-compact .cast-actions {
		font-size: 0.75rem;
	}

	.cast-item-first {
		border-left: none;
		margin-left: 0;
		padding-left: 0;
	}

	.cast-item-reply {
		margin-left: 1.5rem;
		border-left: 1px dashed var(--border);
		padding-left: 1rem;
	}

	.thread-expand {
		padding: 0.5rem;
		text-align: center;
		font-family: 'Space Mono', monospace;
		font-size: 0.85rem;
		color: var(--text-muted);
	}

	.see-thread-link {
		color: var(--accent);
		text-decoration: none;
		font-size: 0.85rem;
	}

	.see-thread-link:hover {
		text-decoration: underline;
	}
</style>
